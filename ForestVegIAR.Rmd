---
params:
  ReportPark: "CHOH"
  ReportYear: 2019
  ReportAllYears: 2017-2021
output:
  html_document
---

```{r, include=F}
knitr::opts_chunk$set(echo=F)
knitr::opts_chunk$set(message=F)
knitr::opts_chunk$set(warning = F)


library(NPSForVeg)
library(tidyverse)
library(DT)
library(magrittr)

NCRN<-importNCRN("C:/Data/NCRN_Veg_2021_Good") #update data
names(NCRN)<-getNames(NCRN, name.class="code")
UsePark<-NCRN[[params$ReportPark]]
UsePlots<-getPlots(UsePark, years=params$ReportYear)$Plot_Name
AllPlots<-getPlots(UsePark)$Plot_Name

```

## `r params$ReportYear` Investigators Annual Report: `r getNames(NCRN[params$ReportPark], name.class ="long")` {.tabset .tabset-fade .tabset-pills} 

### Plot Map 

In `r paste0(params$ReportYear, ", ", length(UsePlots))`, plots were monitored. On the map below, light green circles indicate plots monitored, black circles indicate plots that were not monitored.

```{r}
MapColors<-ifelse(AllPlots %in% UsePlots, 1, 2)

mapPlants(UsePark, plots=AllPlots, values=MapColors, colortype = "numeric", colors=c("lightgreen", "black"))

```


###  `r paste(params$ReportYear,"Data")`{.tabset .tabset-fade .tabset-pills} 


#### Living Trees 

```{r, incldue=F}
if( getPlants(UsePark, "trees", years=params$ReportYear) %>% nrow() >0){
  TreeData<-cbind(
    SiteXSpec(UsePark, years=params$ReportYear, group="trees", values="count", area="ha", Total=F) %>% select(-Plot_Name) %>% colSums() %>% round(1),
    SiteXSpec(UsePark, years=params$ReportYear, group="trees", values= "size", area="ha", Total=F) %>% select(-Plot_Name) %>% colSums() %>% round(1),
    SiteXSpec(UsePark, years=params$ReportYear, group="trees", values= "presab", Total=F) %>% select(-Plot_Name) %>% colSums()
  )

  colnames(TreeData)<-c("Trees/ha", "Basal area (m2)/ha", "Number of Plots")
  TreeData<- TreeData %>% as.data.frame() %>% mutate(`Latin Name`= rownames(.), `Common Name`=getPlantNames(UsePark, `Latin Name`)) %>% 
    select(4,5,1,2,3)
} else TreeData<-NA
```


In `r paste0(params$ReportYear, ", ", nrow(getPlants(UsePark,"trees", years=params$ReportYear) ))` individual living trees were monitored. `r if(!anyNA(TreeData)) paste("See the table below for summary information on each species encountered")`


```{r}
if (!anyNA(TreeData)) datatable(TreeData, rownames=F, options=list(pageLength=25))
```



#### Dead Trees

```{r}
if( getPlants(UsePark, "trees", years=params$ReportYear, status="dead") %>% nrow() >0){
  DeadTreeData<-cbind(
    SiteXSpec(UsePark, years=params$ReportYear, group="trees", status="dead", values="count", area="ha", Total=F) %>% select(-Plot_Name) %>% 
      colSums() %>% round(1),
    SiteXSpec(UsePark, years=params$ReportYear, group="trees", status="dead", values= "presab", Total=F) %>% select(-Plot_Name) %>% colSums()
  )

  colnames(DeadTreeData)<-c("Trees/ha", "Number of Plots")

  DeadTreeData<- DeadTreeData %>% as.data.frame() %>% mutate(`Latin Name`= rownames(.), `Common Name`=getPlantNames(UsePark, `Latin Name`)) %>% 
    select(3,4,1,2)
} else DeadTreeData<-NA

```


In `r paste0(params$ReportYear, ", ", nrow(getPlants(UsePark,"trees", status="dead", years=params$ReportYear) ))` individual dead trees were monitored. `r if(!anyNA(DeadTreeData)) paste("See the table below for summary information on each species encountered")`


```{r}
if (!anyNA(DeadTreeData)) datatable(DeadTreeData, options=list(pageLength=25))
```




#### Saplings

```{r}
if( getPlants(UsePark, "saplings", years=params$ReportYear) %>% nrow() >0){
  SapData<-cbind(
    SiteXSpec(UsePark, years=params$ReportYear, group="saplings", values="count", area="ha", Total=F) %>% select(-Plot_Name) %>% 
      colSums() %>% round(1),
    SiteXSpec(UsePark, years=params$ReportYear, group="saplings", values= "size", area="ha", Total=F) %>% select(-Plot_Name) %>% 
      colSums() %>% round(1),
    SiteXSpec(UsePark, years=params$ReportYear, group="saplings", values= "presab", Total=F) %>% select(-Plot_Name) %>% colSums()
  )

  colnames(SapData)<-c("Saplings/ha", "Basal area (m2)/ha", "Number of Plots")
  SapData<- SapData %>% as.data.frame() %>% mutate(`Latin Name`= rownames(.), `Common Name`=getPlantNames(UsePark, `Latin Name`)) %>% 
    select(4,5,1,2,3)
} else SapData<- NA
```


In `r paste0(params$ReportYear, ", ", nrow(getPlants(UsePark,"saplings", years=params$ReportYear) ))` individual living saplings were monitored. `r if(!anyNA(SapData)) paste("See the table below for summary information on each species encountered")`


```{r}
if (!anyNA(SapData)) datatable(SapData, rownames=F, options=list(pageLength=25))
```





#### Tree Seedlings

```{r}
if( getPlants(UsePark, "seedlings", years=params$ReportYear) %>% nrow() >0){
  SeedData<-cbind(
    SiteXSpec(UsePark, years=params$ReportYear, group="seedlings", values="count", area="ha", Total=F) %>% select(-Plot_Name) %>% 
      colSums() %>% round(1),
    SiteXSpec(UsePark, years=params$ReportYear, group="seedlings", values= "presab", Total=F) %>% select(-Plot_Name) %>% colSums()
  )

  colnames(SeedData)<-c("Tree Seedlings/ha", "Number of Plots")
  SeedData<- SeedData %>% as.data.frame() %>% mutate(`Latin Name`= rownames(.), `Common Name`=getPlantNames(UsePark, `Latin Name`)) %>% 
    select(3,4,1,2)
} else SeedData<-NA
```


In `r paste0(params$ReportYear, ", ", nrow(getPlants(UsePark,"seedlings", years=params$ReportYear) ))` individual living tree seedlings were monitored. `r if(!anyNA(SeedData)) paste("See the table below for summary information on each species encountered")`


```{r}
if (!anyNA(SeedData)) datatable(SeedData, rownames=F, options=list(pageLength=25))
```



#### Shrubs

```{r}
if( getPlants(UsePark, "shrubs", years=params$ReportYear) %>% nrow() >0){
  ShrubData<-cbind(
    SiteXSpec(UsePark, years=params$ReportYear, group="shrubs", values="count", area="ha", Total=F) %>% select(-Plot_Name) %>% colSums() %>% round(1),
    SiteXSpec(UsePark, years=params$ReportYear, group="shrubs", values= "presab", Total=F) %>% select(-Plot_Name) %>% colSums()
  )

  colnames(ShrubData)<-c("Shrubs/ha", "Number of Plots")
  ShrubData<- ShrubData %>% as.data.frame() %>% mutate(`Latin Name`= rownames(.), `Common Name`=getPlantNames(UsePark, `Latin Name`)) %>% 
    select(3,4,1,2)  
} else {ShrubData<-NA}
```


In `r paste0(params$ReportYear, ", ", nrow(getPlants(UsePark,"shrubs", years=params$ReportYear) ))` individual living shrubs were monitored. `r if(!anyNA(ShrubData)) paste("See the table below for summary information on each species encountered")`


```{r}
if (!anyNA(ShrubData)) datatable(ShrubData, rownames=F, options=list(pageLength=25))
```



#### Shrub Seedlings

```{r}
if( getPlants(UsePark, "shseedlings", years=params$ReportYear) %>% nrow() >0){
  ShSeedData<-cbind(
    SiteXSpec(UsePark, years=params$ReportYear, group="shseedlings", values="count", area="ha", Total=F) %>% 
      select(-Plot_Name) %>% colSums() %>% round(1),
    SiteXSpec(UsePark, years=params$ReportYear, group="shseedlings", values= "presab", Total=F) %>% 
      select(-Plot_Name) %>% colSums()
  )

  colnames(ShSeedData)<-c("Shrub Seedlings/ha", "Number of Plots")
  ShSeedData<- ShSeedData %>% as.data.frame() %>% mutate(`Latin Name`= rownames(.), `Common Name`=getPlantNames(UsePark, `Latin Name`)) %>% 
    select(3,4,1,2)
} else ShSeedData<-NA
```


In `r paste0(params$ReportYear, ", ", nrow(getPlants(UsePark,"shseedlings", years=params$ReportYear) ))` individual living shrub seedlings were monitored. `r if(!anyNA(ShSeedData)) paste("See the table below for summary information on each species encountered")`


```{r}
if (!anyNA(ShSeedData)) datatable(ShSeedData, rownames=F, options=list(pageLength=25))
```



#### Vines on Trees

```{r}
if( getPlants(UsePark, "vines", years=params$ReportYear) %>% nrow() >0){
  VineData<-cbind(
    SiteXSpec(UsePark, years=params$ReportYear, group="vines", values="count", area="ha", Total=F) %>% 
      select(-Plot_Name) %>% colSums() %>% round(1),
    SiteXSpec(UsePark, years=params$ReportYear, group="vines", values= "presab", Total=F) %>% 
      select(-Plot_Name) %>% colSums()
  )

  colnames(VineData)<-c("Vines/ha", "Number of Plots")
  VineData<- VineData %>% as.data.frame() %>% mutate(`Latin Name`= rownames(.), `Common Name`=getPlantNames(UsePark, `Latin Name`)) %>% 
    select(3,4,1,2)
} else VineData<-NA
```


In `r paste0(params$ReportYear, ", ", nrow(getPlants(UsePark,"vines", years=params$ReportYear) ))` individual living vines on trees were monitored. `r if(!anyNA(VineData)) paste("See the table below for summary information on each species encountered")`


```{r}
if (!anyNA(VineData)) datatable(VineData, rownames=F, options=list(pageLength=25))
```



#### Understory Plants

```{r}
if( getPlants(UsePark, "herbs", years=params$ReportYear) %>% nrow() >0){
  HerbData<-cbind(
    SiteXSpec(UsePark, years=params$ReportYear, group="herbs", values="size", area="ha", Total=F) %>% 
      select(-Plot_Name) %>% colSums() %>% divide_by(12) %>% round(1),
    SiteXSpec(UsePark, years=params$ReportYear, group="herbs", values= "presab", Total=F) %>% 
      select(-Plot_Name) %>% colSums()
  )

  colnames(HerbData)<-c("% Cover", "Number of Plots")
  HerbData<- HerbData %>% as.data.frame() %>% mutate(`Latin Name`= rownames(.), `Common Name`=getPlantNames(UsePark, `Latin Name`)) %>% 
    select(3,4,1,2)
} else HerbData<-NA
```


In `r paste0(params$ReportYear, ", ", nrow(getPlants(UsePark,"herbs", years=params$ReportYear) ))` observations of understory plants were recorded. `r if(!anyNA(HerbData)) paste("See the table below for summary information on each species encountered")`


```{r}
if (!anyNA(HerbData)) datatable(HerbData, rownames=F, options=list(pageLength=25))
```



###  `r paste("Full Park", min(params$ReportAllYears), "-", max(params$ReportAllYears), "Data")` {.tabset .tabset-fade .tabset-pills} 


#### Living Trees 

```{r, incldue=F}
if( getPlants(UsePark, "trees", years=params$ReportAllYears) %>% nrow() >0){
  AllTreeData<-cbind(
    SiteXSpec(UsePark, years=params$ReportAllYears, group="trees", values="count", area="ha", Total=F) %>% select(-Plot_Name) %>% colSums() %>% round(1),
    SiteXSpec(UsePark, years=params$ReportAllYears, group="trees", values= "size", area="ha", Total=F) %>% select(-Plot_Name) %>% colSums() %>% round(1),
    SiteXSpec(UsePark, years=params$ReportAllYears, group="trees", values= "presab", Total=F) %>% select(-Plot_Name) %>% colSums()
  )

   colnames(AllTreeData)<-c("Trees/ha", "Basal area (m2)/ha", "Number of Plots")
   AllTreeData <- AllTreeData %>% as.data.frame() %>%  mutate(`Latin Name`= rownames(.)) 
   AllTreeData<-AllTreeData %>% rowwise() %>% 
     mutate(`Common Name`=tryCatch(getPlantNames(UsePark, `Latin Name`), error=function(cond){" "})) %>% # this tryCatch business is due to species missing from the commonnames table (Rosaceae Family) 
     select(4,5,1,2,3)
} else AllTreeData<-NA
```


In `r paste( min(params$ReportAllYears),"-",max(params$ReportAllYears), ", ", nrow(getPlants(UsePark,"trees", years=params$ReportAllYears) ))` indvidual living trees were monitored. `r if(!anyNA(AllTreeData)) paste("See the table below for summary information on each species encountered")`


```{r}
if (!anyNA(TreeData)) datatable(AllTreeData, rownames=F, options=list(pageLength=25))
```



#### Dead Trees

```{r}
if( getPlants(UsePark, "trees", years=params$ReportAllYears, status="dead") %>% nrow() >0){
  AllDeadTreeData<-cbind(
    SiteXSpec(UsePark, years=params$ReportAllYears, group="trees", status="dead", values="count", area="ha", Total=F) %>% select(-Plot_Name) %>% 
      colSums() %>% round(1),
    SiteXSpec(UsePark, years=params$ReportAllYears, group="trees", status="dead", values= "presab", Total=F) %>% select(-Plot_Name) %>% colSums()
  )

  colnames(AllDeadTreeData)<-c("Trees/ha", "Number of Plots")

  AllDeadTreeData<- DeadTreeData %>% as.data.frame() %>% 
    mutate(`Latin Name`= rownames(.), `Common Name`=getPlantNames(UsePark, `Latin Name`)) %>% 
    select(3,4,1,2)
} else AllDeadTreeData<-NA

```

In `r paste0(min(params$ReportAllYears),"-",max(params$ReportAllYears), ", ", nrow(getPlants(UsePark,"trees", status="dead", years=params$ReportAllYears) ))` individual dead trees were monitored. `r if(!anyNA(AllDeadTreeData)) paste("See the table below for summary information on each species encountered")`




```{r}
if (!anyNA(DeadTreeData)) datatable(DeadTreeData, options=list(pageLength=25))
```




#### Saplings

```{r}
if( getPlants(UsePark, "saplings", years=params$ReportAllYears) %>% nrow() >0){
  AllSapData<-cbind(
    SiteXSpec(UsePark, years=params$ReportAllYears, group="saplings", values="count", area="ha", Total=F) %>% select(-Plot_Name) %>% 
      colSums() %>% round(1),
    SiteXSpec(UsePark, years=params$ReportAllYears, group="saplings", values= "size", area="ha", Total=F) %>% select(-Plot_Name) %>% 
      colSums() %>% round(1),
    SiteXSpec(UsePark, years=params$ReportAllYears, group="saplings", values= "presab", Total=F) %>% select(-Plot_Name) %>% colSums()
  )

  colnames(AllSapData)<-c("Saplings/ha", "Basal area (m2)/ha", "Number of Plots")
  AllSapData<- AllSapData %>% as.data.frame() %>% mutate(`Latin Name`= rownames(.))
  AllSapData<-AllSapData %>% rowwise() %>% 
     mutate(`Common Name`=tryCatch(getPlantNames(UsePark, `Latin Name`), error=function(cond){" "})) %>%  
    select(4,5,1,2,3)
} else AllSapData<- NA
```


In `r paste0(min(params$ReportAllYears),"-",max(params$ReportAllYears), ", ", nrow(getPlants(UsePark,"saplings", years=params$ReportAllYears) ))` individual living saplings were monitored. `r if(!anyNA(SapData)) paste("See the table below for summary information on each species encountered")`


```{r}
if (!anyNA(AllSapData)) datatable(AllSapData, rownames=F, options=list(pageLength=25))
```



#### Tree Seedlings

```{r}
if( getPlants(UsePark, "seedlings", years=params$ReportAllYears) %>% nrow() >0){
  AllSeedData<-cbind(
    SiteXSpec(UsePark, years=params$ReportAllYears, group="seedlings", values="count", area="ha", Total=F) %>% select(-Plot_Name) %>% 
      colSums() %>% round(1),
    SiteXSpec(UsePark, years=params$ReportAllYears, group="seedlings", values= "presab", Total=F) %>% select(-Plot_Name) %>% colSums()
  )

  colnames(AllSeedData)<-c("Tree Seedlings/ha", "Number of Plots")
  AllSeedData<- AllSeedData %>% as.data.frame() %>% mutate(`Latin Name`= rownames(.), `Common Name`=getPlantNames(UsePark, `Latin Name`)) %>% 
    select(3,4,1,2)
} else AllSeedData<-NA
```


In `r paste0(min(params$ReportAllYears),"-",max(params$ReportAllYears),", ", nrow(getPlants(UsePark,"seedlings", years=params$ReportAllYears) ))` individual living tree seedlings were monitored. `r if(!anyNA(AllSeedData)) paste("See the table below for summary information on each species encountered")`


```{r}
if (!anyNA(AllSeedData)) datatable(AllSeedData, rownames=F, options=list(pageLength=25))
```



#### Shrubs

```{r}
if( getPlants(UsePark, "shrubs", years=params$ReportYear) %>% nrow() >0){
  AllShrubData<-cbind(
    SiteXSpec(UsePark, years=params$ReportAllYears, group="shrubs", values="count", area="ha", Total=F) %>% select(-Plot_Name) %>% colSums() %>% round(1),
    SiteXSpec(UsePark, years=params$ReportAllYears, group="shrubs", values= "presab", Total=F) %>% select(-Plot_Name) %>% colSums()
  )

  colnames(AllShrubData)<-c("Shrubs/ha", "Number of Plots")
  AllShrubData<- AllShrubData %>% as.data.frame() %>%    mutate(`Latin Name`= rownames(.))
  AllShrubData<-AllShrubData %>% rowwise() %>% 
     mutate(`Common Name`=tryCatch(getPlantNames(UsePark, `Latin Name`), error=function(cond){" "})) %>%  
    select(3,4,1,2)  
} else {AllShrubData<-NA}
```


In `r paste0( min(params$ReportAllYears),"-",max(params$ReportAllYears), ", ", nrow(getPlants(UsePark,"shrubs", years=params$ReportAllYears) ))` individual living shrubs were monitored. `r if(!anyNA(AllShrubData)) paste("See the table below for summary information on each species encountered")`


```{r}
if (!anyNA(AllShrubData)) datatable(AllShrubData, rownames=F, options=list(pageLength=25))
```


#### Shrub Seedlings

```{r}
if( getPlants(UsePark, "shseedlings", years=params$ReportAllYears) %>% nrow() >0){
  AllShSeedData<-cbind(
    SiteXSpec(UsePark, years=params$ReportAllYears, group="shseedlings", values="count", area="ha", Total=F) %>% 
      select(-Plot_Name) %>% colSums() %>% round(1),
    SiteXSpec(UsePark, years=params$ReportAllYears, group="shseedlings", values= "presab", Total=F) %>% 
      select(-Plot_Name) %>% colSums()
  )

  colnames(AllShSeedData)<-c("Shrub Seedlings/ha", "Number of Plots")
  AllShSeedData<- AllShSeedData %>% as.data.frame() %>% 
    mutate(`Latin Name`= rownames(.))
  AllShSeedData<-AllShSeedData %>% rowwise() %>% 
     mutate(`Common Name`=tryCatch(getPlantNames(UsePark, `Latin Name`), error=function(cond){" "})) %>%
    select(3,4,1,2)
} else AllShSeedData<-NA
```


In `r paste0( min(params$ReportAllYears),"-",max(params$ReportAllYears), ", ", nrow(getPlants(UsePark,"shseedlings", years=params$ReportAllYears) ))` individual living shrub seedlings were monitored. `r if(!anyNA(AllShSeedData)) paste("See the table below for summary information on each species encountered")`


```{r}
if (!anyNA(AllShSeedData)) datatable(AllShSeedData, rownames=F, options=list(pageLength=25))
```




#### Vines on Trees

```{r}
if( getPlants(UsePark, "vines", years=params$ReportAllYears) %>% nrow() >0){
  AllVineData<-cbind(
    SiteXSpec(UsePark, years=params$ReportAllYears, group="vines", values="count", area="ha", Total=F) %>% 
      select(-Plot_Name) %>% colSums() %>% round(1),
    SiteXSpec(UsePark, years=params$ReportAllYears, group="vines", values= "presab", Total=F) %>% 
      select(-Plot_Name) %>% colSums()
  )

  colnames(AllVineData)<-c("Vines/ha", "Number of Plots")
  AllVineData<- AllVineData %>% as.data.frame() %>% 
    mutate(`Latin Name`= rownames(.), `Common Name`=getPlantNames(UsePark, `Latin Name`)) %>% 
    select(3,4,1,2)
} else AllVineData<-NA
```


In `r paste0( min(params$ReportAllYears),"-",max(params$ReportAllYears), ", ", nrow(getPlants(UsePark,"vines", years=params$ReportAllYears) ))` individual living vines on trees were monitored. `r if(!anyNA(AllVineData)) paste("See the table below for summary information on each species encountered")`


```{r}
if (!anyNA(AllVineData)) datatable(AllVineData, rownames=F, options=list(pageLength=25))
```


#### Understory Plants

```{r}
if( getPlants(UsePark, "herbs", years=params$ReportAllYears) %>% nrow() >0){
  AllHerbData<-cbind(
    SiteXSpec(UsePark, years=params$ReportAllYears, group="herbs", values="size", area="ha", Total=F) %>% 
      select(-Plot_Name) %>% colSums() %>% divide_by(12) %>% round(1),
    SiteXSpec(UsePark, years=params$ReportAllYears, group="herbs", values= "presab", Total=F) %>% 
      select(-Plot_Name) %>% colSums()
  )

  colnames(AllHerbData)<-c("% Cover", "Number of Plots")
  AllHerbData<- AllHerbData %>% as.data.frame() %>% 
    mutate(`Latin Name`= rownames(.), `Common Name`=getPlantNames(UsePark, `Latin Name`)) %>% 
    select(3,4,1,2)
} else AllHerbData<-NA
```


In `r paste0( min(params$ReportAllYears),"-",max(params$ReportAllYears),", ", nrow(getPlants(UsePark,"herbs", years=params$ReportAllYears) ))` observations of understory plants were recorded. `r if(!anyNA(AllHerbData)) paste("See the table below for summary information on each species encountered")`


```{r}
if (!anyNA(AllHerbData)) datatable(AllHerbData, rownames=F, options=list(pageLength=25))
```


